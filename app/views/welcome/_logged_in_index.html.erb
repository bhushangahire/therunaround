<%- content_for :javascripts do -%>
<script type="text/javascript">
  <%= @facebook_publish_feed_story %>
</script>
<%- end -%>
<%= render :partial => '/shared/flashboard' %>

<div class="clearfix">
  <div class="bluebox">
    <h3>Where did you run recently?</h3>

    <% form_tag do %>
      <table class="add_run_table">
        <tr>
          <td class="editor_key">
            <label id="label_route" for="route">Where did you go?</label>
          </td>
          <td class="editor_value">
            <%= text_field_tag :route, '', :size => 20, :class => 'inputtext' %>
          </td>
        </tr>
        <tr>
          <td class="editor_key">
            <label id="label_miles" for="miles">Number of Miles</label>
          </td>
          <td class="editor_value">
            <%= text_field_tag :miles, '', :size => 20, :class => 'inputtext' %>
          </td>
        </tr>
        <tr>
          <td class="editor_key"><label>Date (MM/DD/YYYY)</label></td>
          <td class="editor_value">
            <%= text_field_tag :date_month, '', :size => 2, :maxlength => 2, :class => 'inputtext datefield' %>
            /<%= text_field_tag :date_day, '', :size => 2, :maxlength => 2, :class => 'inputtext datefield' %>
            /<%= text_field_tag :date_year, '', :size => 4, :maxlength => 4, :class => 'inputtext datefield' %>
           |
           <a onclick="populate_date('<%= Time.now.mon %>', '<%= Time.now.day %>', '<%= Time.now.year %>'); return false;">Today</a>
           |
           <a onclick="populate_date('<%= Time.now.yesterday.mon %>', '<%= Time.now.yesterday.day %>', '<%= Time.now.yesterday.year %>'); return false;">Yesterday</a>
          </td>
        </tr>
      </table>

      <%- style = facebook_user ? '' : 'visibility:hidden' %>
      <p id="publish_fb_checkbox" style="<%= style %>">
        <img src="http://static.ak.fbcdn.net/images/icons/favicon.gif" />
        <input type="checkbox" name="publish_to_facebook" checked />
        Publish this run to Facebook
      </p>
      <input class="inputsubmit" type="submit" name="submit" value="Add Run"/>
    <%- end -%>
  </div>

  <% if current_user.runs.any? -%>
    <div id="showruns" class="bluebox">
      <h3>Recent Runs</h3>
      <table>
        <tr>
          <th>Date</th>
          <th>Miles</th>
          <th>Route</th>
        </tr>
        <%- current_user.runs.each do |run| -%>
          <tr>
            <td><%= run.date.strftime('%m/%d/%Y') %></td>
            <td><%= pluralize(run.miles, 'mile') %></td>
            <td><%= run.route %></td>
          </tr>
        <%- end -%>
      </table>

      <%- if current_user.miles > 0 -%>
        <div style="padding: 5px; font-weight: bold;">You ran <%= pluralize(current_user.miles, 'mile') %> recently!</div>
      <%- end -%>
    </div>
  <% end -%>

  <!-- If a facebook user, then show info about their friends -->
  <%- if facebook_user -%>
    <%= render :partial => 'friends' %>
  <%- end -%>

</div>
